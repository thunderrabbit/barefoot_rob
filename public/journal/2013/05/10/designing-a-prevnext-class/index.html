<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Designing a prevnext class &middot; Barefoot Rob</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="thunderrabbit" />
    <meta name="twitter:title" content="Designing a prevnext class &middot; Barefoot Rob">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Designing a prevnext class &middot; Barefoot Rob">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href='https://new.robnugen.com/css/all.min.css'>
    <link rel="stylesheet" href='https://new.robnugen.com/css/barefoot_rob.css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Barefoot Rob" href='https://new.robnugen.com/index.xml' />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://new.robnugen.com/">Barefoot Rob</a></h1>
            <h2 class="brand-tagline"> keep expanding </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href='/'>
                        <i class="fa"></i> home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/journal'>
                        <i class="fa"></i> journal
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/blog'>
                        <i class="fa"></i> blog
                    </a>
                </li>
                
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">10 May 2013, 18:28</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2013/05/10/designing-a-prevnext-class/" class="post-title">Designing a prevnext class</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>
                    
                    <div class="post-description">
                        <p>##18:28 Friday 10 May 2013</p>

<p>Today at work I had a brilliant idea to have prev(ious) and next buttons work as expected.</p>

<p>The blog entry index allows people to view e.g. only this category or that category or just this month or just last years entries.</p>

<p>Once they click the link to view a specific entry, the site has no idea what order nor what subset of entries was in the index.  I&rsquo;ve solved the problem in the past by storing in lawnchair a list of all the ids, in order, resulting from the search.  With 60,000 entries, that makes the index page slow because all that data is being searched and processes in the background.</p>

<p>While looking for a faster way to solve it, I realized an ingenious solution!!   I&rsquo;ll store in lawnchair the <em>query</em> and then just run the query with appropriate OFFSET and LIMIT to get the prev/next entries!</p>

<p>I got the query saved in lawnchair and was just about to AJAX the query to the server upon arrival at the blog entry page and I realized, OH CRAP!!  What an excellent system for running arbitrary SQL on the server!!!</p>

<p>(For the lay reader, this is a Very Bad Thing)</p>

<p>Crap.</p>

<p>So I scrapped my code and went back to my flexible A4 sized drawing board.</p>

<p>I dug around on SO a bit looking for insight and pretty much decided there&rsquo;s no way to do it without storing the query.  So the prevnext table was born.</p>

<p>Essentially, it&rsquo;s user_id and query_key as a grouped index, then a query as the query.</p>

<p>I&rsquo;ve got a class that talks to that table, and I think I&rsquo;m pretty close to having it work.  If it does work as planned, I&rsquo;ll probably port it to the system with 60,000 entries and make its index wonderfully faster.</p>

<p>I probably would have finished it today, but it&rsquo;s Friday night and Lin and I are going out with Nonie in Tokyo.</p>

                    </div>
                    
                </section>
            </div>
            <div class="pager">
                  <a href="https://new.robnugen.com/journal/2013/05/10/out-with-lin-and-nonie/" rel="prev" style="float: left!important">❮ Out with Lin and Nonie</a>
                  <a href="https://new.robnugen.com/journal/2013/05/10/dream-karaoke-drink/" rel="next" style="float: right!important"> dream karaoke drink ❯</a>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src='https://new.robnugen.com/js/all.min.js'></script>

        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
