<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hakyll &middot; Barefoot Rob</title>

    <meta name="description" content="keep expanding">

    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="thunderrabbit" />
    <meta name="twitter:title" content="hakyll &middot; Barefoot Rob">
    <meta name="twitter:description" content="keep expanding">

    <meta property="og:type" content="article">
    <meta property="og:title" content="hakyll &middot; Barefoot Rob">
    <meta property="og:description" content="keep expanding">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href='https://new.robnugen.com/css/all.min.css'>
    <link rel="stylesheet" href='https://new.robnugen.com/css/barefoot_rob.css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Barefoot Rob" href='https://new.robnugen.com/index.xml' />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://new.robnugen.com/">Barefoot Rob</a></h1>
            <h2 class="brand-tagline"> keep expanding </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href='/'>
                        <i class="fa"></i> home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/journal'>
                        <i class="fa"></i> journal
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/blog'>
                        <i class="fa"></i> blog
                    </a>
                </li>
                
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">08 Nov 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/11/08/imported-all-entries-from-my-wordpress-into-hakyll/" class="post-title">Imported all entries from my Wordpress into Hakyll</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##22:41 Friday 07 November 2014 JST##</p>

<p>Got all the text as far as I can tell, though the tags sometimes have capital letters.  BUT the much bigger problem is that none of the images were imported.  Their links are embedded in the entries, but the actual files are on robnugen.com/blog/wordpress/whatsit</p>

<p>##10:13am Saturday 8 November 2014 JST</p>

<p>Okay, so last night I forked and tweaked <a href="https://github.com/mloskot/exitwp/tree/exitwp-hakyll">mloskot/exitwp-hakyll</a>
so now I have my own <a href="https://github.com/thunderrabbit/exitwp/tree/exitwp-hakyll">hakyll version of exitwp</a></p>

<p>I tweaked the code so it would use &ldquo;.md&rdquo; as the file extension, insert the entry date inside the body of the text the way I like, and I upated the README a bit.</p>

<p>(I also made it say &ldquo;tags&rdquo; instead of &ldquo;categories&rdquo; because I don&rsquo;t plan to have categories in my Hakyll journal, at least not yet)</p>

<p>After</p>

<pre><code>pip install pyyaml
</code></pre>

<p>Then</p>

<pre><code>python exitwp-hakyll.py
</code></pre>

<p>processed the xml file perfectly but I was like, &ldquo;hey where are the images?&rdquo;</p>

<p>Turns out the images are not included in the export from Wordpress, which just produces an XML file of the textual data.  Links to images are simply HTML links within the body of the entries.</p>

<p>Part of me wants to solve it in code:</p>

<pre><code>for each file in the output
   regex search for links to images
   for each regex found
      determine new URL (path)
      download the file from old URL to new path
      update the link in the text file
</code></pre>

<p>But it will be simpler overall to just migrate the whole file structure via scp like Martin did in May: <a href="https://blog.8thcolor.com/en/2014/05/migrate-from-wordpress/">From Wordpress to Jekyll</a></p>

<p>So here&rsquo;s what I did:</p>

<pre><code>mkdir ~/journal-images
cd ~/journal-images
scp -r robnugen.com:~/robnugen.com/blog/wp-content/uploads/* .
</code></pre>

<p>Then with Finder moved the images from <code>~/journal-images</code> to where they should be in my local hakyll repo. (I used Finder because some of the directory names overlap, and many of the directories were empty!)</p>

<p>Search and replace over all new markdown files: <code>https://robnugen.com/blog/wp-content/uploads/</code> â†’ <code>/images/</code></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">07 Nov 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/11/07/a-reasonable-way-to-insert-images/" class="post-title">A reasonable(?) way to insert images</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##10:02 Friday 07 November 2014 JST##</p>

<p>Though I still have to copy the image names by hand, once they are in
the correct directories, I have a pretty okay way of inserting them
into my journal pages.</p>

<p>For most images, I&rsquo;ve settled on a convention of putting the main
image in a directory, and then thumbnails for the image(s) in a</p>

<pre><code class="language-thumbs/```">
For most of *those* images, I place them in ```images/yyyy/mm/```
directories for the year and month they were taken.  Images that are taken
as part of a project that lasts more than a month will get their own
directory at a deeper level, probably at ```images/project-name```.

Given that my journal entries are also in dated directories, I can
take the date of the current filename and use that to determine the
likely name of the directory in which the images for that entry are
located.

So, with this keystroke in emacs,

</code></pre>

<p>C-x !</p>

<pre><code>
I run this code in [my version of
hakyll.el](https://gist.github.com/thunderrabbit/453c1e1c4a959f113d10/50f674b040070c5d7af43f1c8ec455010b13387f)
(appropriate code snippet copied here):

    (defun hakyll-insert-image (alt-text)
      &quot;Insert an image from /images/yyyy/mm to current buffer /posts/yyyy/mm/dd/....md&quot;
      (interactive &quot;sAltText: &quot;)
      (let ((yyyymm (substring buffer-file-name 35 42)))
        (insert
         (format &quot;![%s](/images/%s/thumbs/&quot;
    	     alt-text
    	     yyyymm
    	     ))
        )
      )

This shortcut is named after the fact that markdown uses ! in its code to display an image:

</code></pre>

<p><img src="/path/to/image.png" alt="alt text" /></p>

<pre><code>
The 35 and 42 in the ```substring``` function are quite specific to my
system.  I had had a longer set of functions including ```nthcdr```,
</code></pre>

<p>split<code>,</code>concat``` (I think), and something else, so I decided
to just lobotomize it. 1% chance I&rsquo;ll put them back to make it
(vaguely) more portable sometime in the mysterious future.</p>

<p>Anyway, the 35 and 42 are designed to extract &ldquo;<sup>2014</sup>&frasl;<sub>11</sub>&rdquo; from
&ldquo;/Users/thunderrabbit/journal/posts/2014/11/07/a-reasonable-way-to-insert-images.md&rdquo;</p>

<hr />

<p>So, to insert an image, I find the image in Finder and copy the
filename and extension.</p>

<p>In emacs, after starting a journal entry (with <code>C-x j</code>), I insert
an image with <code>C-x !</code>.</p>

<p>A prompt asks for a string to use as &ldquo;alt text&rdquo; for the image, and, if
I enter &ldquo;Izuku in Shinagawa&rdquo;, the function will insert this into my
file buffer:</p>

<pre><code>![Izuku in Shinagawa](/images/2014/11/thumbs/
</code></pre>

<p>To which I append my paste buffer and &ldquo;)&rdquo; for <code>Izuku in Shinagawa 2 Nov 2014.png)</code></p>

<p>and end up with:</p>

<pre><code>![Izuku in Shinagawa](/images/2014/11/thumbs/Izuku in Shinagawa 2 Nov 2014.png)
</code></pre>

<p>Which is rendered as:</p>

<p><img src="/images/2014/11/thumbs/Izuku in Shinagawa 2 Nov 2014.png" alt="Izuku in Shinagawa" /></p>

<p><em>Then</em>, I <code>C-a</code> to the beginning of the line and type <code>C-x @</code>
 (named because @ is after ! on my keyboard), which runs the following
 macro:</p>

<pre><code>(fset 'markdown-add-real-image-to-thumb
   [?\[ ?\C-s ?\] return ?\C-k ?\C-y ?\] ?\C-y ?\C-x ?\C-x return backspace ?\C-s ?t ?h ?u ?m ?b ?s return backspace backspace backspace backspace backspace backspace backspace ?\C-a ?\C-n])
</code></pre>

<p>Thereby converting this line:</p>

<pre><code>![Izuku in Shinagawa](/images/2014/11/thumbs/Izuku in Shinagawa 2 Nov 2014.png)
</code></pre>

<p>to this:</p>

<pre><code>[![Izuku in Shinagawa](/images/2014/11/thumbs/Izuku in Shinagawa 2
Nov 2014.png)](/images/2014/11/Izuku in Shinagawa 2 Nov 2014.png)
</code></pre>

<p>Which renders as this:</p>

<p><a href="/images/2014/11/Izuku in Shinagawa 2 Nov 2014.png"><img src="/images/2014/11/thumbs/Izuku in Shinagawa 2
Nov 2014.png" alt="Izuku in Shinagawa" /></a></p>

<p>(which looks the same, but now can be clicked for a bigger image.)</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">05 Nov 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/11/05/pre-pre-release-of-hakyll-journal/" class="post-title">pre pre-release of hakyll-journal</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##20:12 Wednesday 05 November 2014 JST##</p>

<p>I&rsquo;m so lucky to have an awesome programmer friend like Travis.  :-)</p>

<p>Over the past few days we have been emailing back and forth, mostly
with me going &ldquo;uh huh&rdquo; &ldquo;yeah&rdquo; &ldquo;that&rsquo;s right&rdquo; &ldquo;great!&rdquo; as he explains
the intricacies of the best way to create a haskell library.</p>

<p>I&rsquo;ve been studying <a href="https://learnyouahaskell.com/">Learn You a Haskell</a>
and considering buying Graham Hutton&rsquo;s book, and am excited to have my
static journal back, very excited to have Travis making a kick-ass
library to seamlessly(?) connect with Hakyll to make it
journalistic&hellip;  I&rsquo;m certain that some of the code he writes will end
up in the main Hakyll library.</p>

<p>I&rsquo;ve been watching my new/old/new hakyll-journal repository, and just
happened to catch the first little bit, 3 minutes after he committed
it.</p>

<p><a href="/images/2014/11/hakyll-journal age 3 minutes.png"><img src="/images/2014/11/thumbs/hakyll-journal age 3 minutes.png" alt="hakyll-journal age 3 minutes" /></a></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">30 Oct 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/10/30/tutorial-running-hakyll-for-free-on-aws/" class="post-title">Tutorial- running Hakyll for free on AWS</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##20:20 Thursday 30 October 2014 JST##</p>

<p>These notes should work for *nix, including OS X, which I&rsquo;m using.  Windows users may have to adapt when it comes to local stuff.</p>

<p>Easy as</p>

<ol>
<li>get server with root access</li>
<li>set up Nginx on server</li>
<li>set up Hakyll locally</li>
</ol>

<p>##1. sign up for AWS micro (free tier available)##</p>

<p>I will probably go with all their defaults:</p>

<p>####Step 1:####</p>

<p>For this, I&rsquo;m using <code>Amazon Linux AMI 2014.09.1 (HVM) - ami-b5a7ea85</code> because it&rsquo;s at the top of the AMI list when creating a new EC2 instance, offers a free tier, and includes Docker, which I&rsquo;ve heard about more than twice, but know nothing of it yet.</p>

<p>####Step 2:####</p>

<p>t2.micro (free tier eligible)</p>

<p>####Step 3 (Configture Instance details)####</p>

<p>leave defaults</p>

<p>####Step 4 Add Storage:####</p>

<p>Root /dev/xvda snap-62cf04aa  8GiB  <del>Magnetic</del> gp2  Not Encrypted</p>

<p>####Step 5 Tag Instance:####</p>

<p>Anything you like is fine.  For me:</p>

<pre><code>Name : hakyll.robnugen.com
</code></pre>

<p>####Step 6 Configure Security Group:####</p>

<p>Create a new security group.  Any name is fine.</p>

<p>Security group name: hakyll.robnugen.com</p>

<p>Make sure it has the following two rules:</p>

<pre><code>SSH from My IP
HTTP from anywhere
</code></pre>

<p>####Review and Launch####</p>

<p>I got a popup saying I can use SSD for free, so I&rsquo;m selecing that.  (I had selected Magnetic in step 4 above)</p>

<p>####Save the PEM####</p>

<p>The very final step results in a popup asking which PEM you want to
use to access the server.  If you don&rsquo;t have a PEM file, download and
save the file in your ~/.ssh directory.  After saving, set its
permissions to 400:</p>

<pre><code>cd ~/.ssh
chmod 400 your-pem-filename.pem
</code></pre>

<p>##2. set up Nginx on server##</p>

<p>####Step 1, connect to server:####</p>

<p>Set up a config file in your local <code>~/.ssh</code> folder:</p>

<pre><code>cd ~/.ssh
nano config
</code></pre>

<p>And make it look something like this:</p>

<pre><code>Host *
ServerAliveInterval 120

Host hakyll
    HostName your.ip.addr.ess
    User ec2-user
    IdentityFile ~/.ssh/your-pem-file.pem
</code></pre>

<p>Now, connecting to the server is simple:</p>

<pre><code>ssh hakyll
</code></pre>

<p>####Step 2, set up nginx:####</p>

<p>Install nginx on server:</p>

<pre><code>sudo yum update
sudo yum install nginx
sudo chown ec2-user /usr/share/nginx/html
</code></pre>

<p>##3. Set up Hakyll locally##</p>

<p>We&rsquo;ve done all the groundwork; the rest is easy!</p>

<p>Back on your local computer:</p>

<p>####Step 1:####</p>

<pre><code>git clone git@github.com:thunderrabbit/hakyll-journal.git journal
cd journal
ghc --make -threaded site.hs
./site rebuild
./site deploy
</code></pre>

<p>Finished!   Check out my journal on your server!  Feel free to wipe the sub-directories in ~/journal/post and write your own.  ;-)</p>

<p>After each change, you can update the site like this:</p>

<pre><code>./site rebuild
./site deploy
</code></pre>

                    </div>
                </section>
                
                <h1 class="content-subhead">29 Oct 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/10/29/first-with-date/" class="post-title">First with date</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##23:20 Wednesday 29 October 2014##</p>

<p>Been working on hakyll.robnugen.com all day, and it seems I have a
framework with which I may be happy for a while.  I&rsquo;ve essentially
finished the first three of the items from <a href="https://hakyll.robnugen.com/2014/10/28/Journal-plans/">Journal
Plans</a>, although
I&rsquo;ve just realized that while that link works, the link to that entry
from my index does not (due to capitalization).  Once I fix the index
link, this link won&rsquo;t work unless I remember.</p>

<p>I&rsquo;ve almost got <a href="https://raw.githubusercontent.com/Abizern/prelude/master/personal/hakyll.el">Abizern&rsquo;s hakyll.el</a> file adapted for use in this new framework.</p>

<p>But for now it&rsquo;s bedtime.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">28 Oct 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/10/28/running-hakyll-on-aws/" class="post-title">Running Hakyll on AWS</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Running Hakyll on <del>Dreamhost</del> AWS</p>

<p>UPDATE: <a href="/2014/10/30/tutorial-running-hakyll-for-free-on-aws/">Run Hakyll for free on AWS</a> is a better tutorial than the mess below.</p>

<p>I gave up trying to install Hakyll on Dreamhost when I realized I probably wouldn&rsquo;t be able to install Haskell at all. I have a ticket in to DH now, but I bet they&rsquo;ll say &ldquo;sorry, not on shared hosting; why don&rsquo;t you try our VPS?&rdquo;</p>

<p>The following is based on notes I took from <a href="https://marcanuy.com/en/notes/18-deploying-a-laravel-website-with-git">https://marcanuy.com/en/notes/18-deploying-a-laravel-website-with-git</a> (currently 404, RIP old link), and
<a href="https://chrisdone.com/posts/hakyll-and-git-for-you-blog">https://chrisdone.com/posts/hakyll-and-git-for-you-blog</a></p>

<p>This is a work in progress; better go elsewhere instead of follow the potholed minefield ahead:</p>

<p>Easy as</p>

<ol>
<li>get server with root access</li>
<li>set up Hakyll</li>
<li>set up git</li>
</ol>

<p>##1. sign up for AWS micro (free tier available)##</p>

<p>I will probably go with all their defaults:</p>

<p>####Step 1:####</p>

<p>For this, I&rsquo;m using <code>Amazon Linux AMI 2014.09.1 (HVM) - ami-b5a7ea85</code> because it&rsquo;s at the top of the AMI list when creating a new EC2 instance, offers a free tier, and includes Docker, which I&rsquo;ve heard about more than twice, but know nothing of it yet.</p>

<p>####Step 2:####</p>

<p>t2.micro (free tier eligible)</p>

<p>####Step 3 (Configture Instance details)####</p>

<p>leave defaults</p>

<p>####Step 4 Add Storage:####</p>

<p>Root /dev/xvda snap-62cf04aa  8GiB  <del>Magnetic</del> gp2  Not Encrypted</p>

<p>####Step 5 Tag Instance:####</p>

<p>Name : hakyll.robnugen.com</p>

<p>####Step 6 Configure Security Group:####</p>

<p>Create a new security group</p>

<p>Security group name: hakyll.robnugen.com</p>

<p>SSH from My IP</p>

<p>####Review and Launch####</p>

<p>I got a popup saying I can use SSD for free, so I&rsquo;m selecing that.  (I had selected Magnetic in step 4 above)</p>

<p>##2. Set up Hakyll on server##</p>

<p>##3. Set up git on server##</p>

<p>On Server, set up bare repo:</p>

<pre><code>cd ~/
mkdir bare
mkdir bare/hakyll.git
cd bare/hakyll.git 
git init --bare
</code></pre>

<p>Create hook for compiling the site after push:</p>

<pre><code>emacs ~/bare/hakyll.git/hooks/post-update
</code></pre>

<p>Make it look like this:</p>

<pre><code>#!/bin/sh
work_tree=~/robnugen.com/hakyll
GIT_WORK_TREE=$work_tree git checkout -f
ghc --make hakyll
./hakyll build
</code></pre>

<p>// cd $work_tree</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">27 Oct 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2014/10/27/hakyll-journal/" class="post-title">Hakyll journal</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##01:55:08 Tue 28 Oct 2014##</p>

<p>Boom.  Got me what might be my new journal for a long time to come, if I can figure out how to make the directory structure the way I want, and ifff I can figure out a way to put images in here that is fast and friendly and all that.</p>

<p>I -<em>might</em>- attempt to write a thingy in Haskell to do it.</p>

<p>For now, I just need to set up a way to serve this from Dreamhost.</p>

                    </div>
                </section>
                
            </div>
            

            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src='https://new.robnugen.com/js/all.min.js'></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
