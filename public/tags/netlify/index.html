<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>netlify &middot; Barefoot Rob</title>

    <meta name="description" content="keep expanding">

    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="thunderrabbit" />
    <meta name="twitter:title" content="netlify &middot; Barefoot Rob">
    <meta name="twitter:description" content="keep expanding">

    <meta property="og:type" content="article">
    <meta property="og:title" content="netlify &middot; Barefoot Rob">
    <meta property="og:description" content="keep expanding">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href='https://new.robnugen.com/css/all.min.css'>
    <link rel="stylesheet" href='https://new.robnugen.com/css/barefoot_rob.css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Barefoot Rob" href='https://new.robnugen.com/index.xml' />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://new.robnugen.com/">Barefoot Rob</a></h1>
            <h2 class="brand-tagline"> keep expanding </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href='/'>
                        <i class="fa"></i> home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/journal'>
                        <i class="fa"></i> journal
                    </a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href='https://new.robnugen.com/blog'>
                        <i class="fa"></i> blog
                    </a>
                </li>
                
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">25 Sep 2019, 07:46</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2019/09/25/how-netlify-helped-me-fix-my-website/" class="post-title">How Netlify helped me fix my website</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>My website stopped working recently.  More accurately,
<a href="https://gohugo.io">Hugo</a> stopped rendering the /blog and /journal
portions of my website.  The last time it worked was 2 weeks ago.  I
noticed that my local version of Hugo had gotten updated (*) and
checked the releases.. sure enough there was a change to something
related to that I had tweaked regarding indices.</p>

<p>The problem languished for a while until I remembered that <a href="https://www.netlify.com/blog/2017/04/11/netlify-plus-hugo-0.20-and-beyond/">Netlify
allows choosing which version of Hugo to use</a>.</p>

<p>That, along with building every branch, allowed me to test at exactly
<em>which</em> version of Hugo my site stopped being rendered properly.</p>

<p>I had already created a mini version of my site, so I whipped up a
shell script <code>netlify.sh</code>to slap a bunch of different branches with different
versions of Hugo requested.</p>

<pre><code>#!/usr/bin/env bash

VERSION=$1
BRANCH=hugo${VERSION//\./}
FILE=netlify.toml

echo &quot;version $VERSION&quot;
echo &quot;branch $BRANCH&quot;

git checkout master
git branch -f $BRANCH
sleep 1
git checkout $BRANCH

sed -i '' s/&quot;0.54.0&quot;/&quot;$VERSION&quot;/g $FILE

git add $FILE

sleep 1

git commit -m &quot;Hugo $VERSION

to narrow down when it stopped working&quot;

sleep 1

git push origin $BRANCH

sleep 1

git log --oneline --graph --decorate --all
</code></pre>

<p>The <code>sleep</code> commands are there to keep git from locking itself out of the directory.</p>

<p>This allowed me to run</p>

<p><code>./netlify.sh 0.45</code></p>

<p>where 0.45 is a version number I wanted to test.</p>

<p>I thereby created a bunch of branches&hellip;</p>

<pre><code>* 77836e3 (origin/hugo0471, hugo0471) Hugo 0.47.1
| * 1254cd2 (origin/hugo047, hugo047) Hugo 0.47
|/
| * 41014f0 (origin/hugo046, hugo046) Hugo 0.46
|/
| * cb8b953 (origin/hugo0451, hugo0451) Hugo 0.45.1
|/
| * ee47137 (origin/hugo0422, hugo0422) Hugo 0.42.2
|/
| * df2c69f (origin/hugo0403, hugo0403) Hugo 0.40.3
|/
| * ea775d5 (origin/hugo039, hugo039) Hugo 0.39
|/
| * 1caa175 (origin/hugo0382, hugo0382) Hugo 0.38.2
|/
| * a826419 (origin/hugo038, hugo038) Hugo 0.38
|/
| * 2b4b63c (origin/hugo0371, hugo0371) Hugo 0.37.1
|/
| * c69e973 (origin/hugo037, hugo037) Hugo 0.37
|/
| * 01c68bf (origin/hugo0361, hugo0361) Hugo 0.36.1
|/
| * 609b6c4 (origin/hugo036, hugo036) Hugo 0.36
|/
| * c885d55 (origin/hugo040, hugo040) Hugo 0.40
|/
| * a8e7ea5 (origin/hugo041, hugo041) Hugo 0.41
|/
| * b0a8b51 (origin/hugo042, hugo042) Hugo 0.42
|/
| * d1710b2 (origin/hugo043, hugo043) Hugo 0.43
|/
| * d3d75d0 (origin/hugo044, hugo044) Hugo 0.44
|/
| * 522256c (origin/hugo045, hugo045) Hugo 0.45
|/
* 3b956b6 (HEAD -&gt; master, origin/master) Use baseurl = &quot;/&quot; for running on Netlify
* e77f687 Simplify debugging by removing ghost files
* e11a45e Pared down site from https://github.com/thunderrabbit/journal-hugo
</code></pre>

<p>And Netlify quickly created all of them so I could figure out which
ones worked and which ones did not.</p>

<ul>
<li><a href="https://hugo046--angry-lumiere-228f57.netlify.com">https://hugo046--angry-lumiere-228f57.netlify.com</a></li>
<li><a href="https://hugo045--angry-lumiere-228f57.netlify.com">https://hugo045--angry-lumiere-228f57.netlify.com</a></li>
<li><a href="https://hugo044--angry-lumiere-228f57.netlify.com">https://hugo044--angry-lumiere-228f57.netlify.com</a></li>
<li><a href="https://hugo043--angry-lumiere-228f57.netlify.com">https://hugo043--angry-lumiere-228f57.netlify.com</a></li>
<li><a href="https://hugo042--angry-lumiere-228f57.netlify.com">https://hugo042--angry-lumiere-228f57.netlify.com</a></li>
</ul>

<p>etc etc</p>

<p><em>None of them worked!</em></p>

<pre><code>(☉_☉)
</code></pre>

<p>(*) The fact that the local version had gotten updated automagically
should have been a clue that the auto-updating Hugo had <em>not</em> caused
the problem.  I had no idea when the updates happened, but the problem
suddenly started, and I assumed an update was the cause.</p>

<p>&ldquo;Well, boys, I was wrong.&rdquo;</p>

<h3 id="it-was-my-mistake-all-along">it was my mistake all along</h3>

<p>In an attempt to fix my top page, I had tweaked this and that, where
this and that are the main repo site, and sub-module theme,
respectively.  During the process, I did not notice that I had also
broken the entire site. Part of the not noticing was due to the
current way I have Hugo set up, it does not wipe the output <code>public/</code>
directory before creating the site.  (Although I intended to and
thought I had activated that option.)</p>

<p>here&rsquo;s where it gets tricky.  My current site consists of multiple
submodules, the two mentioned above, a couple others which have not
changed in months (years), and my journal entries, which currently has
8500+ files.  There are enough journal files that when I try to run
Hugo on my site locally, it crashes with too many files open.  I
cannot let Hugo watch for changes so I have to restart Hugo each time
I make a change.</p>

<p>Let&rsquo;s see if I can offload that task to Netlify.</p>

<p>Basic idea:</p>

<ol>
<li>Start with my local website repository</li>
<li>Wipe all files from the public/ directory</li>
<li>Copy the remaining files to a new directory</li>
<li>git checkout abcdef123 &ndash;recurse-submodules</li>
<li>Create a branch</li>
<li>Push to Netlify</li>
</ol>

<p>or</p>

<ol>
<li>Wipe most of the journal entries</li>
<li>Run the code locally</li>
</ol>

<h5 id="12-56-wednesday-25-september-2019-jst">12:56 Wednesday 25 September 2019 JST</h5>

<p>Getting closer.  I made a script I called <code>commitlify.sh</code></p>

<pre><code>#!/usr/bin/env bash

COMMIT=$1
BRANCH=hugo_${COMMIT//\./}

echo &quot;commit $COMMIT&quot;
echo &quot;branch $BRANCH&quot;

rm -rf public/

ls public/

git checkout $COMMIT --recurse-submodules

git branch -f $BRANCH

sleep 1

git checkout $BRANCH

sleep 1

git push origin $BRANCH

sleep 1

hugo server -w=0
</code></pre>

<p>It does a similar thing as the previous script, but deals with
submodules being aligned with the main repo&rsquo;s HEAD.  The last line
tells Hugo to serve the site, but not to monitor it for changes.</p>

<p>This is fine for now because I am just poking around to see which
commits were breaking commits.</p>

<h5 id="21-58">21:58</h5>

<p>I found a <a href="https://bitbucket.org/thunderrabbit/purehugo/commits/16559a8ffa3ec74f57af7398a90f259f41972675">breaking commit that used to be a genius commit</a>, but
apparently its genius did not survive changes in Hugo.</p>

<h5 id="00-32-thursday-26-september-2019-jst">00:32 Thursday 26 September 2019 JST</h5>

<p>And now I have gotten enough of the errors out of the system that I
can get Netlify to build <em>something</em> with the repo.  I still do not
have /blog nor /journal indices working, but getting closer.  There
were a couple of commits that did work, so .. oh I can try one now.</p>

<p>Dangit.  There are different errors with some commits I marked as
working in my local setup.</p>

<p>Too tired to work on it now.  good night!</p>

<h5 id="22-20-thursday-26-september-2019-jst">22:20 Thursday 26 September 2019 JST</h5>

<p>Yayyy!!  As of today, I got an <a href="https://new-robnugen-com-fallible-abandoned-58f942.netlify.com">old version of my site</a> working on
Netlify.</p>

<p>Both the
<a href="https://new-robnugen-com-fallible-abandoned-58f942.netlify.com/journal/">journal</a>
and
<a href="https://new-robnugen-com-fallible-abandoned-58f942.netlify.com/blog/">blog</a>
have their own pages, and the top page shows just the blog entries.</p>

<p>The pagination on the top page is messed up, but now that I have
something working, I can ask peeps on the Hugo forum for help on
that.  My attempt to fix that is what broke my site in the first
place.</p>

<p>Okay..  now to get my journal entries and blog entries up to date!</p>

<p>Go to main repo directory</p>

<pre><code>cd ~/journal-hugo
</code></pre>

<p>Keep track of the old master branch</p>

<pre><code>git branch -f old_master c670763
</code></pre>

<p>Move the master branch to the branch that is working now (<a href="https://bitbucket.org/thunderrabbit/journal-hugo/commits/bbfbe552a5a6f8b9337af3ac41ee359250a309df">bbfbe552a5a6f8b9337af3ac41ee359250a309df</a>)</p>

<pre><code>git branch -f master
</code></pre>

<p>It took 45 minutes to deploy before, so this may be up in 45 minutes.
<a href="https://new-robnugen-com-fallible-abandoned-58f942.netlify.com">https://new-robnugen-com-fallible-abandoned-58f942.netlify.com</a></p>

<p>Oh dang, I triggered a deploy by uploading my latest journal without
uploading this latest change.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">07 Mar 2015, 07:16</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2015/03/07/netlify-now-does-git-clone-recursive/" class="post-title">Netlify now does git clone --recursive!</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##07:16 Saturday 07 March 2015 JST##</p>

<p>As of yesterday, I noticed that <a href="https://www.netlify.com">Netlify</a> added &ndash;recursive to their clone process.</p>

<p>Yay!  I like to think it was because of my suggestion that they do it.  If not, it&rsquo;s pretty amazing timing!  Thanks, Mathias!</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">03 Mar 2015, 22:25</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://new.robnugen.com/journal/2015/03/03/netlify-doesnt-git-clone-recursive/" class="post-title">Netlify doesn&#39;t git clone --recursive</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Rob Nugen</strong>
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>##22:25 Tuesday 03 March 2015 JST##</p>

<p>I got my repos sorted today; all the journal entries have had
frontmatter lobotomies if Middleman can&rsquo;t deal with the different
dates, and my main Middleman repo includes the journal entry repo as a
submodule.</p>

<p>However, turns out netlify doesn&rsquo;t clone recursively (yet).  I
mentioned this to Mathias and he was like, &ldquo;hmm you&rsquo;re right&rdquo; and said
he would look into it.  But, he said politely, he was planning to go
home for the night and didn&rsquo;t want to push any possibly-breaking
changes before going to bed.</p>

<p>HAHhahaa most def.  We&rsquo;ll see if they get it sorted out soon!  Then
I&rsquo;ll have a temporary space for journals before I figure out how
Middleman does deploys natively, decide what URL to use (hakyll?  but
it&rsquo;s not Hakyll anymore&hellip; hmmm), and set it all up.</p>

<p>Maybe I&rsquo;ll go with new.robnugen.com until it&rsquo;s a site that can take
over for all the crap on robnugen.com now (fat chance?) then kill
robnugen.com as I switch new.robnugen.com to www.robnugen.com.  Damn
what a lot of <del>broken links</del> <ins>redirects</ins> I have
planned!</p>

                    </div>
                </section>
                
            </div>
            

            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src='https://new.robnugen.com/js/all.min.js'></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
