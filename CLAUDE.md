# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

A Hugo static site for [robnugen.com](https://www.robnugen.com/) — Rob Nugen's personal website ("Connection Coach For Men"). The site is bilingual (English + Japanese) and uses a custom Perl event generation pipeline to create content files.

## Development Commands

```bash
# Start local dev server (no drafts)
./build_locally.sh

# Start local dev server and open browser
./build_locally.sh y

# Start local dev server with drafts visible
./build_locally.sh y y

# Hugo directly (equivalent options)
hugo server       # no drafts
hugo server -D    # with drafts
```

## Event Generation Workflow

Events are created using Perl scripts, not written by hand.

**Generate a new event interactively:**
```bash
./generate_events.pl
# Follow prompts to select event type, location, date, time, image URL
# At the end, a generator file is saved to event_generators/YYYY_MM_DD_log.txt
# Extract the generator from the bottom of that log file
```

**Re-run a saved generator (e.g., after editing dates/times):**
```bash
./generate_events.pl < event_generators/2021/2021_10_09_Izumi_Tamagawa.txt
```

**Generate a blog post from an event:**
```bash
./generate_blog_from_event.pl
```

Generator data files live in `event_generators/YYYY/` (named `YYYY_MM_DD_descriptive_name.txt`). The log for each run is `event_generators/YYYY_MM_DD_log.txt`.
To turn a log into a reusable generator: the log may contain multiple `STARTING_ANEW` … `FINISHED_ADIEU` blocks if the run was repeated to correct mistakes — use the **last** block. Strip its `STARTING_ANEW` and `FINISHED_ADIEU` lines, then save as `event_generators/YYYY/YYYY_MM_DD_name.txt`.

## Architecture

### Hugo Content

- `content/events/YYYY/MM/` — Event pages (bilingual: `*.en.md` / `*.ja.md`)
- `content/blog/YYYY/MM/DD/` — Blog posts
- `content/books/`, `content/quests/`, `content/offerings/`, etc. — Other sections
- `content/_index.md` / `content/_index.ja.md` — Homepage content

Only `events` is configured as a `mainSection` (shows on homepage).

**Event front matter fields:**
```yaml
title: "..."
tags: ["2025", "barefoot", "walk", ...]
author: Rob Nugen
date: 2025-06-05T18:47:47+09:00
EventLocation: "Shin Yuri Art Park"
EventTime: "14:00"
EventDate: "2025-06-07T14:00:00+09:00"
EventType: "Barefoot grounding"
```

Blog permalink structure: `/blog/:year/:month/:day/:title/`

### Perl Event Pipeline

- `generate_events.pl` — Main event creation script; interactive drill-down menu selects event type → location → fills templates
- `generate_blog_from_event.pl` — Auto-generates blog posts from events
- `rpl/Constants.pm` — All path configuration and template mappings (event types, walk locations, cuddle party venues, pricing). Set `$BAREFOOT_ROB_MASTER` env var to override repo path.
- `rpl/BLTConstants.pm` — Bold Life Tribe monthly themes and weekly subtopics
- `rpl/Functions.pm` — Utility functions for file I/O, date handling, user prompts

**Template files** live in `templates/event_templates/<event_type>/<location>/` and contain `%s`-style sprintf placeholders. Each event type produces multiple output files (`.en.md`, `.ja.md`, `.facebook.txt`, `.meetup.txt`, `.peatix.txt`, `.welcome_email.txt`, etc.).

### Hugo Configuration

- Theme: `purehugo` (git submodule in `themes/purehugo/`)
- Bilingual: English (`/en/`) and Japanese (`/ja/`), with `defaultContentLanguageInSubdir = true`
- Custom layouts in `layouts/` override theme defaults
- Images are hosted externally at `https://b.robnugen.com/` under `blog/YYYY/topic/` or `journal/YYYY/topic/`

## Key Conventions

- All event content files are generated by Perl scripts — do not create them by hand unless necessary
- Bilingual files always come in pairs: `filename.en.md` + `filename.ja.md`
- Event generator input files use `YYYY_MM_DD_descriptive_name.txt` naming
- The `BAREFOOT_ROB_MASTER` environment variable can override the repo path in Perl scripts (defaults to `~/barefoot_rob_master`)
